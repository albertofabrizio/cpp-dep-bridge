# cpp-dep-bridge

**cpp-dep-bridge** is a build-aware C++ dependency extraction tool.

It analyzes **real CMake build graphs** (not just manifests) and produces:

- accurate dependency graphs
- machine-readable SBOMs (CycloneDX first)
- optional dependency submission data for CI systems

The goal is **deterministic, auditable dependency metadata** for modern C++ projects.

---

## Non-goals

This project is **not**:

- a build system
- a package manager
- a vulnerability scanner
- a CMake replacement or wrapper

It consumes existing builds and reports what they _actually_ use.

---

## Design principles

The project is guided by a few core principles:

- **Build truth over declarations**  
  Prefer what the compiler and linker actually use over what manifests claim.

- **Determinism over heuristics**  
  The same input should always produce the same output.

- **Separation of concerns**  
  Ingestion, normalization, and SBOM emission are strictly layered.

- **No silent guessing**  
  Missing data is left empty rather than inferred incorrectly.

These principles favor correctness and auditability over convenience.

---

## Versioning & Stability

**cpp-dep-bridge** follows **Semantic Versioning** (`MAJOR.MINOR.PATCH`) with the following policy:

- Versions **`0.x.y`** are **alpha**
- Breaking changes **may occur between minor versions**
- Patch versions are reserved for bug fixes only

### What is considered stable today
- Internal dependency model
- CMake File API ingestion (codemodel v2)
- Deterministic component identity generation
- CycloneDX SBOM emission

### What is still evolving
- Component classification (system vs third-party vs project-local)
- Dependency filtering policies
- Variant normalization (e.g. debug/release artifacts)
- Optional metadata enrichment (versions, licenses, purl)

Until **`v1.0.0`**, users should expect:
- SBOM contents to change as semantics improve
- No guarantees on backward compatibility of output
- Clear documentation of breaking changes in release notes

Each tagged release documents its guarantees explicitly.

---

## What the SBOM represents

The SBOM generated by **cpp-dep-bridge** reflects **what the build actually links against**, as observed from the CMake build graph and linker inputs.

In particular:

- Components are derived from **real build dependencies**, not declared manifests
- Imported CMake targets (`X::Y`) are resolved to **package-level components**
- Platform and toolchain libraries (e.g. Windows SDK on MSVC) may appear
- Debug/release variants may appear as distinct components (alpha behavior)

This means the SBOM answers the question:

> “What libraries does this binary depend on according to the build system?”

It does **not** currently:
- infer package versions
- guess licenses
- enrich components from package managers

Those capabilities are intentionally deferred.

---

## Requirements

- **CMake ≥ 3.25**
- **C++20 compiler**
- Ninja (recommended)
- Dependencies provided via **vcpkg or Conan**:
  - `fmt`
  - `nlohmann_json`
  - (optional) `CLI11`

---

## Getting started (preset-first)

This project is **preset-only**.  
Do not invoke raw `cmake ..` commands.

### 1. Clone

```bash
git clone https://github.com/albertofabrizio/cpp-dep-bridge.git
cd cpp-dep-bridge
```

### 2. Configure (development build)

```bash
cmake --preset dev
```

### 3. Build

```bash
cmake --build --preset dev
```

### 4. Run tests (optional)

```bash
ctest --preset ci
```

---

## Minimal usage example

After configuring and building a project with CMake:

```bash
depbridge scan <build-directory> > sbom.json
```

Example:
```bash
depbridge scan out/build/dev > sbom.json
```

This produces a CycloneDX SBOM (sbom.json) describing the dependencies
observed in the build graph.

The build directory must contain a completed CMake configuration
with File API replies available.

---

## Available presets

| Preset    | Purpose                                               |
| --------- | ----------------------------------------------------- |
| `dev`     | Default development build (RelWithDebInfo)            |
| `debug`   | Debug build                                           |
| `asan`    | Debug + Address/UB sanitizers                         |
| `release` | Optimized release build                               |
| `ci`      | Strict build (warnings as errors, sanitizers enabled) |

To list presets:

```bash
cmake --list-presets
```

---

## Preset philosophy

Presets are **part of the project contract**:

- CI uses the same presets as developers
- IDEs auto-detect them
- Reproducing issues locally should never require guessing flags

Local, machine-specific overrides belong in `CMakeUserPresets.json`  
(which is intentionally **not committed**).

---

## Project structure (high level)

```text
include/   → public headers
src/       → implementation
tests/     → unit and integration tests
cmake/     → CMake helper modules
docs/      → architecture and design notes
```

---

## License

Apache License 2.0  
See `LICENSE` and `NOTICE` for details.

---

## Status

**Alpha (v0.2.x)**

The project can generate **real, non-empty CycloneDX SBOMs** from actual
CMake builds.

APIs and output semantics may evolve between minor versions.
See GitHub Releases for details.

---

## Roadmap (short term)

Planned for upcoming alpha releases:

- Component classification (system / third-party / project-local)
- Dependency filtering policies
- Build-variant normalization (e.g. debug vs release artifacts)
- Optional metadata enrichment (opt-in)


